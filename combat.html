<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>5x5 Grid & Encounter Generator</title>
<style>
  body {
    background-color: #1e1e1e;
    color: white;
    font-family: Arial, sans-serif;
    text-align: center;
    margin: 0;
    padding: 10px;
  }
  h1 {
    margin-bottom: 10px;
    font-size: 1.3em;
  }
  button {
    background-color: #444;
    color: white;
    border: none;
    padding: 10px 20px;
    font-size: 1.1em;
    margin: 12px 0;
    border-radius: 8px;
    cursor: pointer;
  }
  button:hover {
    background-color: #666;
  }
  #grid {
    display: grid;
    grid-template-columns: 10% repeat(5, 1fr);
    gap: 3px;
    justify-items: center;
    width: 100%;
    max-width: 90vw;
    margin: 0 auto;
  }
  .tile {
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    border-radius: 8px;
    color: white;
    width: 100%;
    aspect-ratio: 1/1;
    font-size: 5vw;
    user-select: none;
  }
  .label {
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 4vw;
    color: #ccc;
    width: 100%;
    aspect-ratio: 1/1;
  }
  .tile:hover {
    filter: brightness(1.3);
    transform: scale(1.08);
    transition: all 0.12s;
  }
  
  @keyframes pulse {
    0%,100% { opacity: 1; }
    50%     { opacity: 0.75; }
  }
  @media (min-width: 500px) {
    .tile { font-size: 2.2em; }
    .label { font-size: 1.4em; }
  }
</style>
</head>
<body>
<h1>5×5 Encounter Generator</h1>

<div style="display:flex; justify-content:center; gap:12px; margin:12px 0;">
  <label>Party Level: <input id="partyLevel" type="number" value="5" min="1" style="width:60px; text-align:center;"></label>
  <label>Players: <input id="numPlayers" type="number" value="3" min="1" style="width:60px; text-align:center;"></label>
</div>

<button id="generate">Generate Encounter</button>

<h3 id="zone-display" style="margin:12px 0;">Zone: —</h3>
<h3 id="monster-display" style="margin:12px 0;">Monsters: —</h3>
<h3 id="bonus-room-display" style="margin:12px 0;">Bonus Room: —</h3>
<h3 id="loot-display" style="margin:12px 0;">Loot: —</h3>

<div id="grid"></div>

<script type="module" src="constants.js"></script>
<script>

  

  function generateGrid() {
    const totalWeight = fixedWeights.reduce((a, b) => a + b, 0);
    const probabilities = fixedWeights.map(w => w / totalWeight);

    const gridContainer = document.getElementById("grid");
    gridContainer.innerHTML = "";

    // Corner
    gridContainer.appendChild(createLabel(""));

    // Column labels
    colLabels.forEach(c => gridContainer.appendChild(createLabel(c)));

    // Rows + tiles
    for (let r = 0; r < 5; r++) {
      gridContainer.appendChild(createLabel(rowLabels[r]));

      for (let c = 0; c < 5; c++) {
        const tileType = weightedRandom(tileTypes, probabilities);
        const tile = document.createElement("div");
        tile.className = "tile";
        tile.style.backgroundColor = tileType.color;
        tile.textContent = tileType.symbol;
        if (tileType.name === "Special") tile.classList.add("special-glow");
        gridContainer.appendChild(tile);
      }
    }
  }

  function createLabel(text) {
    const el = document.createElement("div");
    el.className = "label";
    el.textContent = text;
    return el;
  }

  function weightedRandom(items, probs) {
    let r = Math.random();
    let sum = 0;
    for (let i = 0; i < items.length; i++) {
      sum += probs[i];
      if (r <= sum) return items[i];
    }
    return items[items.length - 1];
  }

  

  function generateZone() {
    const d1 = Math.floor(Math.random() * 6) + 1;
    const d2 = Math.floor(Math.random() * 6) + 1;
    const roll = d1 * 10 + d2;
    const zone = zoneTable[roll] || "Unknown Zone";
    document.getElementById("zone-display").textContent = `Zone: ${zone}`;
  }

  


  function tierIndexFromRoll(tierRoll) {
    if (tierRoll <= 6) return 0;
    if (tierRoll <= 8) return 1;
    if (tierRoll <= 10) return 2;
    if (tierRoll <= 12) return 3;
    if (tierRoll <= 14) return 4;
    return 5;
  }

  function generateMonsters() {
    const level = Math.max(1, parseInt(document.getElementById("partyLevel").value) || 1);
    const players = Math.max(1, parseInt(document.getElementById("numPlayers").value) || 1);

    let prefix = Math.random() < 0.5 ? "O" : "E";
    const d2 = Math.floor(Math.random() * 6) + 1;
    const catKey = `${prefix}${d2}`;
    const cat = monsterData[catKey] || { label: "???", subs: [] };

    let totalEnemies = players + Math.floor(Math.random() * (players + 1));
    totalEnemies = Math.max(1, Math.min(12, totalEnemies));

    const tierRoll = Math.floor(Math.random() * 6) + 1 + Math.floor(level / 3);
    const tierIdx = tierIndexFromRoll(tierRoll);
    const subtype = cat.subs[tierIdx] || { name: "???", hp: "?", notes: "" };

    const lines = [
      `${cat.label} — ${cat.notes || ""}`,
      `${totalEnemies}× ${subtype.name} (${subtype.hp} HP)`,
      subtype.notes ? `(${subtype.notes})` : ""
    ].filter(Boolean);

    document.getElementById("monster-display").textContent = `Monsters: ${lines.join(" · ")}`;
  }

  

  function generateBonusRoom() {
    const catIdx = Math.floor(Math.random() * bonusRoomData.length);
    const actionIdx = Math.floor(Math.random() * 6);
    const cat = bonusRoomData[catIdx];
    const action = cat.actions[actionIdx];
    document.getElementById("bonus-room-display").textContent = `Bonus Room: ${cat.req} — ${action}`;
  }

  

  function generateLoot() {
    const roll = Math.floor(Math.random() * 6) + 1; // 1-6
    let entry;

    if (roll <= 2) {
      entry = lootTable[0]; // both 1 and 2 use the first entry
    } else {
      entry = lootTable[roll - 1];
    }

    let text = `${entry.type}`;
	
    if (entry.categories) {
	  // Pick two different categories (X → Y)
	  let idx1 = Math.floor(Math.random() * entry.categories.length);
	  let idx2 = Math.floor(Math.random() * entry.categories.length);
	  while (idx2 === idx1) {
		idx2 = Math.floor(Math.random() * entry.categories.length);
	  }
	  const fromCat = entry.categories[idx1];
	  const toCat = entry.categories[idx2];
	  text += ` → Transforms: ${fromCat} → ${toCat}`;
	}

    if (entry.options) {
      const optIdx = Math.floor(Math.random() * entry.options.length);
      text += ` → ${entry.options[optIdx]}`;
    }

    if (entry.artifact) {
      const artIdx = Math.floor(Math.random() * artifacts.length);
      text += `, Powered by Artifact: ${artifacts[artIdx]}`;
    }

    document.getElementById("loot-display").textContent = `Loot: ${text}`;
  }

  // === Generate Everything ===
  function generateAll() {
    generateGrid();
    generateZone();
    generateMonsters();
    generateBonusRoom();
    generateLoot();
  }

  document.getElementById("generate").addEventListener("click", generateAll);

  // Initial generation
  generateAll();
</script>
</body>
</html>














