<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Fallout Character Sheet</title>

  <style>
    body { margin:0; font-family: monospace; background:#0b120b; color:#9fef9f; }
    .app { max-width:900px; margin:auto; padding:12px; background:#0f1f0f; box-shadow:0 0 20px #0f0; }
    h2 { color:#7cff7c; text-shadow:0 0 6px #0f0; margin-top:16px; }
    .grid { display:grid; gap:8px; }
    .title { grid-template-columns:1fr 1fr; }

    input, textarea {
      background:#081408; color:#9fef9f;
      border:1px solid #2cff2c; padding:6px;
      font-family:monospace; width:100%; box-sizing:border-box;
    }

    .card { background:#081408; border:1px solid #2cff2c; padding:8px; }
    .center { text-align:center; }

    .stats, .armor, .hp-area, .negatives, .inventory {
      margin:10px 0;
    }

    .stats { grid-template-columns: repeat(5, 1fr); }
    .stat-box input { text-align:center; font-size:18px; }

    .armor {
      display:flex;
      flex-direction:row;
      gap:8px;
      flex-wrap:nowrap;
    }

    .armor-box {
      flex:1 1 0;
      min-width:0;
      box-sizing:border-box;
      padding:10px;
      border:2px solid;
      display:flex;
      flex-direction:column;
      justify-content:center;
      align-items:center;
    }

    .armor-label {
      font-weight:bold;
      margin-bottom:6px;
      display:block;
      font-size:clamp(10px, 2.5vw, 16px);
    }

    .p-theme { background:#331111; border-color:#ff5c5c; }
    .e-theme { background:#112233; border-color:#5ca9ff; }
    .x-theme { background:#332211; border-color:#ffb85c; }
    .r-theme { background:#113311; border-color:#6dff6d; }

    .armor-box input {
      text-align:center;
      font-size:clamp(14px, 4vw, 22px);
      font-weight:bold;
      background:transparent;
      border:none;
      color:inherit;
    }

    .hp-area {
      display:grid;
      grid-template-columns: 1fr 72px;
      gap:8px;
      align-items:stretch;
      margin:10px 0;
    }

    .hp-box {
      position:relative;
      height:180px;
      display:flex;
      flex-direction:column;
      align-items:center;
      padding-top:6px;
    }

    .hp-title {
      font-size:20px;
      letter-spacing:2px;
      margin-bottom:4px;
    }

    .hp-center {
      flex:1;
      display:flex;
      align-items:center;
      justify-content:center;
      position:relative;
      width:100%;
    }

    .hp-btn {
  position:absolute;
  top:50%;
  transform:translateY(-50%);
  font-size: clamp(18px, 4vw, 28px);
  background:#081408;
  color:#9fef9f;
  border:1px solid #2cff2c;
  padding: clamp(2px, 0.5vw, 4px) clamp(6px, 1vw, 12px);
}
    .hp-minus { left:8px; }
    .hp-plus { right:8px; }

    .hp-plus10 {
  right: 8px;
  top: 15%;
  transform: translateY(-50%);
  font-size: clamp(14px, 3vw, 20px);
  padding: clamp(2px, 0.5vw, 4px) clamp(4px, 1vw, 8px);
}

	
	#hp {
      font-size:42px;
      text-align:center;
      width:160px;
      background:#081408;
      border:1px solid #2cff2c;
      padding:4px;
    }

    .hp-lower-row {
      display:flex;
      flex-direction:row;
      align-items:center;
      justify-content:center;
      gap:12px;
      margin-top:6px;
    }
	
	

    .addiction-box {
      width:110px;
      text-align:center;
      cursor:pointer;
      background:#081408;
      border-color:#2cff2c;
      color:#9fef9f;
      box-shadow:none;
    }

    .withdraw-box {
      display:flex;
      align-items:center;
      justify-content:center;
    }

    .withdraw-box input {
  appearance: none;
  width: 20px;
  height: 20px;
  border: 1px solid #2cff2c;
  background: #081408;
  cursor: pointer;
  position: relative;
  box-shadow: 0 0 4px #2cff2c;
}

.withdraw-box input:checked {
  background: #0f2f0f;
  border-color: #2cff2c;
  box-shadow: 0 0 6px #2cff2c;
}

.withdraw-box input:checked::after {
  content: "X";
  position: absolute;
  top: -1px;
  left: 4px;
  font-size: 18px;
  font-weight: bold;
  color: #2cff2c;
}

    .uses {
      display:grid;
      grid-template-rows: repeat(3, 1fr);
      gap:6px;
    }

    .use-box {
      display:flex; align-items:center; justify-content:center;
      font-weight:bold; cursor:pointer; user-select:none;
      border:1px solid; padding:6px;
    }
    .use-on { background:#0f2f0f; border-color:#2cff2c; box-shadow:0 0 8px #2cff2c; }
    .use-off { background:#2a0000; border-color:#ff3c3c; color:#ff9c9c; box-shadow:0 0 8px #ff3c3c; }

    .negatives { grid-template-columns: repeat(5, 1fr); }
    .neg-card { text-align:center; min-width:0; padding:4px; }
    .neg-value { font-size:22px; }
    .neg-btn-row { display:flex; justify-content:center; gap:4px; }
    .neg-btn { padding:1px 4px; background:#081408; color:#9fef9f; border:1px solid #2cff2c; font-size:14px; }

    .inventory { grid-template-columns:1fr; }
    .slot {
  display:flex;
  flex-direction:column;
  gap:6px;
  background:#040a04;        /* darker than inside */
  border:1px solid #2cff2c;
  padding:6px;
}


    .slot-top {
      display:grid;
      grid-template-columns: 32px 1fr 36px;
      gap:6px;
      height:4.5em;
      align-items:stretch;
    }

    .slot textarea {
      flex:1;
      resize:none;
      font-size:clamp(10px,3vw,14px);
      line-height:1.2em;
    }

    .heavy-toggle {
      width: 36px;
      height: 100%;
      border: 1px solid #2cff2c;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      position: relative;
      background: #081408;
      transition: background 0.2s, border-color 0.2s;
    }

    .heavy-toggle::before {
      content: "H";
      font-size: 26px;
      color: rgba(255, 0, 0, 0.25);
      position: absolute;
    }

    .heavy-on {
      border-color: #ff3c3c;
      background: #2a0000;
      box-shadow: 0 0 8px #ff3c3c;
    }

    .heavy-on::before {
      color: #ff3c3c;
    }

    .dropdown-toggle {
      cursor:pointer;
      font-size:18px;
      padding:2px 0;
      border:1px solid #2cff2c;
      background:#081408;
      color:#9fef9f;
      width:32px;
      text-align:center;
      user-select:none;
      display:flex;
      align-items:center;
      justify-content:center;
    }

    .dropdown-area {
  display:none;
  padding:0;
  border:none;
  background:transparent;
}


    .dropdown-area.open {
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:8px;
    }

    .inv-counter-card { padding:4px; }

    .neg-title-input {
      width:100%;
      background:#081408;
      border:1px solid #2cff2c;
      color:#9fef9f;
      padding:2px 4px;
      text-align:center;
      margin-bottom:2px;
      font-weight:bold;
    }

    .inv-counter-btn-row {
      display:flex;
      justify-content:center;
      align-items:center;
      gap:6px;
    }

    .inv-counter-value {
      font-size:28px;
      padding:0 6px;
      text-align:center;
      min-width:40px;
    }

    .inv-counter-btn {
      padding:1px 4px;
      background:#081408;
      color:#9fef9f;
      border:1px solid #2cff2c;
      font-size:14px;
      cursor:pointer;
    }
  </style>
</head>

<body>
<div class="app">
  <h2>Fallout Character Sheet</h2>

  <div class="grid title card">
    <input id="name" placeholder="Character Name">
    <input id="skillName" placeholder="Skill">
    <input id="level" placeholder="Level">
    <input id="caps" placeholder="Caps">
  </div>

  <div class="grid stats" id="stats"></div>

  <div class="armor" id="armor"></div>

  <div class="hp-area">
    <div class="card hp-box">
      <div class="hp-title">HIT POINTS</div>

      <div class="hp-center">
        <button class="hp-btn hp-minus" onclick="chgHP(-1)">−</button>

<input id="hp">

<button class="hp-btn hp-plus" onclick="chgHP(1)">+</button>

<button class="hp-btn hp-plus10" onclick="chgHP10()">+10%</button>

      </div>

      <div class="hp-lower-row">
        <div id="addictionToggle" class="use-box addiction-box">ADDICTED</div>

        <label class="withdraw-box">
          <input type="checkbox" id="withdraw1">
        </label>

        <label class="withdraw-box">
          <input type="checkbox" id="withdraw2">
        </label>
      </div>
    </div>

    <div class="uses">
      <div id="useSkill" class="use-box">SKILL</div>
      <div id="useLuck" class="use-box">LUCK</div>
      <div id="useResist" class="use-box">RESIST</div>
    </div>
  </div>

  <div class="grid negatives" id="negatives"></div>

  <div class="grid inventory" id="inventory"></div>
</div>

<script>
const STORAGE_KEY="fallout_character_v10";
const statNames=["STR","AGI","END","INT","CHA"];
const armorTypes=[
  ['Physical','p'],
  ['Energy','e'],
  ['Explosive','x'],
  ['Rad','r']
];
const negNames=["Hunger","Thirst","Fatigue","Rads","Injury"];

let state=JSON.parse(localStorage.getItem(STORAGE_KEY))||{
  name:"", skillName:"", level:"", caps:"",
  hp:"20/20",
  stats:Object.fromEntries(statNames.map(s=>[s,""])),
  armor:{Physical:"",Energy:"",Explosive:"",Rad:""},
  neg:Object.fromEntries(negNames.map(n=>[n,0])),
  inventory:Array.from({length:12},()=>({
    name:"",
    heavy:false,
    dropdown:false,
    counters:[
      {title:"", value:0},
      {title:"", value:0},
      {title:"", value:0}
    ]
  })),
  uses:{skill:false,luck:false,resist:false},
  addiction:false,
  withdraw1:false,
  withdraw2:false
};

function save(){ localStorage.setItem(STORAGE_KEY,JSON.stringify(state)); }

function parseHP(){
  const parts = state.hp.split("/");
  let cur = parseInt(parts[0]) || 0;
  let max = parseInt(parts[1]) || cur;
  return {cur,max};
}

function updateHPDisplay(){
  hp.value = state.hp;
}

function chgHP(d){
  let {cur,max} = parseHP();
  cur = Math.max(0, Math.min(max, cur + d));
  state.hp = `${cur}/${max}`;
  updateHPDisplay();
  save();
}

function chgNeg(n,d){
  state.neg[n]=Math.max(0,state.neg[n]+d);
  const el=document.getElementById(n);
  el.innerText=state.neg[n];
  el.style.color=state.neg[n]>5?'#ff4c4c':'#9fef9f';
  save();
}

function chgHP10() {
  let {cur, max} = parseHP();
  let amount = Math.ceil(max * 0.10);
  cur = Math.min(max, cur + amount);
  state.hp = `${cur}/${max}`;
  updateHPDisplay();
  save();
}


function toggleHeavy(i){
  state.inventory[i].heavy = !state.inventory[i].heavy;
  save();
  renderHeavy(i);
}

function renderHeavy(i){
  const el = document.getElementById("heavy"+i);
  if(state.inventory[i].heavy){
    el.classList.add("heavy-on");
  } else {
    el.classList.remove("heavy-on");
  }
}

function toggleDropdown(i){
  state.inventory[i].dropdown = !state.inventory[i].dropdown;
  save();
  renderDropdown(i);
}

function renderDropdown(i){
  const area = document.getElementById("droparea"+i);
  const toggle = document.getElementById("dropbtn"+i);
  if(state.inventory[i].dropdown){
    area.classList.add("open");
    toggle.innerText="▲";
  } else {
    area.classList.remove("open");
    toggle.innerText="▼";
  }
}

function chgCounter(i,c,d){
  state.inventory[i].counters[c].value =
    Math.max(0, state.inventory[i].counters[c].value + d);
  save();
  document.getElementById(`count${i}_${c}`).innerText =
    state.inventory[i].counters[c].value;
}

function init(){
  name.value=state.name;
  skillName.value=state.skillName;
  level.value=state.level;
  caps.value=state.caps;

  name.oninput=e=>{state.name=e.target.value;save();};
  skillName.oninput=e=>{state.skillName=e.target.value;save();};
  level.oninput=e=>{state.level=e.target.value;save();};
  caps.oninput=e=>{state.caps=e.target.value;save();};

  updateHPDisplay();
  hp.oninput = e => {
    state.hp = e.target.value;
    save();
  };

  const statsDiv=document.getElementById('stats');
  statNames.forEach(s=>{
    statsDiv.innerHTML+=
      `<div class='card stat-box center'>
         <b>${s}</b>
         <input value='${state.stats[s]}' 
           oninput="state.stats['${s}']=this.value;save();">
       </div>`;
  });

  const armorDiv=document.getElementById('armor');
  armorTypes.forEach(([label,c])=>{
    armorDiv.innerHTML+=
      `<div class='armor-box ${c}-theme'>
         <b class='armor-label'>${label}</b>
         <input value='${state.armor[label]}' 
           oninput="state.armor['${label}']=this.value;save();">
       </div>`;
  });

  const negDiv=document.getElementById('negatives');
  negNames.forEach(n=>{
    negDiv.innerHTML+=
      `<div class='card neg-card'>
         <b>${n}</b>
         <div id='${n}' class='neg-value'>${state.neg[n]}</div>
         <div class='neg-btn-row'>
           <button class='neg-btn' onclick="chgNeg('${n}',-1)">−</button>
           <button class='neg-btn' onclick="chgNeg('${n}',1)">+</button>
         </div>
       </div>`;
    if(state.neg[n]>5) document.getElementById(n).style.color='#ff4c4c';
  });

  const invDiv=document.getElementById('inventory');
  state.inventory.forEach((it,i)=>{
    invDiv.innerHTML+=
      `<div class='card slot'>
         <div class="slot-top">
           <div id="dropbtn${i}" class="dropdown-toggle" onclick="toggleDropdown(${i})">▼</div>

           <textarea rows='3'
             oninput="state.inventory[${i}].name=this.value;save();">${it.name}</textarea>

           <div id="heavy${i}" class="heavy-toggle" onclick="toggleHeavy(${i})"></div>
         </div>

         <div id="droparea${i}" class="dropdown-area"></div>
       </div>`;
  });

  state.inventory.forEach((it,i)=>{
    renderHeavy(i);
    renderDropdown(i);

    const area = document.getElementById("droparea"+i);
    area.innerHTML = "";

    it.counters.forEach((c,j)=>{
      area.innerHTML +=
        `<div class="card neg-card inv-counter-card">
           <input class="neg-title-input" type="text" value="${c.title}"
             oninput="state.inventory[${i}].counters[${j}].title=this.value;save();">
           <div class="inv-counter-btn-row">
             <button class="neg-btn inv-counter-btn" onclick="chgCounter(${i},${j},-1)">−</button>
             <div id="count${i}_${j}" class="inv-counter-value">${c.value}</div>
             <button class="neg-btn inv-counter-btn" onclick="chgCounter(${i},${j},1)">+</button>
           </div>
         </div>`;
    });
  });

  ['skill','luck','resist'].forEach(k=>{
    const el=document.getElementById('use'+k.charAt(0).toUpperCase()+k.slice(1));
    function render(){ el.className='use-box '+(state.uses[k]?'use-on':'use-off'); }
    el.onclick=()=>{ state.uses[k]=!state.uses[k]; save(); render(); };
    render();
  });

  const addictionEl = document.getElementById("addictionToggle");

  function renderAddiction() {
    addictionEl.className = "use-box addiction-box";
    if (state.addiction) {
      addictionEl.classList.add("use-off");
    
   // red state
  }
}

addictionEl.onclick = () => {
  state.addiction = !state.addiction;
  save();
  renderAddiction();
};

renderAddiction();

}

init();
</script>

</body>
</html>
