<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Integer & Weapon Generator</title>
<style>
/* Ensure padding doesn't break widths */
* { box-sizing: border-box; }

body {
  font-family: system-ui, sans-serif;
  background: #1e1e2f;
  color: #eee;
  margin: 0;
  padding: 1rem;
  display: flex;
  flex-direction: column;
  align-items: center;
}
h1,h2 { text-align:center; margin:.5rem 0; }

.container {
  background: #2a2a40;
  padding: 1rem;
  border-radius: 1rem;
  width: 100%;
  max-width: 400px;
  box-sizing: border-box;
  margin-bottom: 1rem;
}

/* form controls */
input[type=number], input[type=range], select, button {
  width:100%;
  padding:.5rem;
  border-radius:.5rem;
  border:none;
  text-align:center;
  margin-bottom:.6rem;
  font-size:1rem;
  box-sizing: border-box;
}
button { background:#4e8cff; color:#fff; font-weight:bold; }
button:hover { background:#2a6ce2; }

.bars{
  display:flex;
  justify-content:space-between;
  align-items:flex-end;
  height:120px; /* prevents overlap with button */
  margin-top:1rem; /* gap under the button */
}
.bar-container{ display:flex; flex-direction:column; align-items:center; width:22%; }
.bar{
  width:100%;
  border-radius:.3rem;
  min-height:5px;
  transition:height .3s ease;
  display:flex;
  justify-content:center;
  align-items:flex-end;
  color:#fff;
  font-size:1rem;
  font-weight:bold;
  text-shadow:-1px -1px 0 #000,1px -1px 0 #000,-1px 1px 0 #000,1px 1px 0 #000;
  overflow:hidden;
}
#bar1{ background:linear-gradient(180deg,#ff5e5e,#d43e3e); } /* Physical - red */
#bar2{ background:linear-gradient(180deg,#5ec8ff,#2e9ed4); } /* Energy - blue */
#bar3{ background:linear-gradient(180deg,#ffbd5e,#e68b2e); } /* Explosive - orange */
#bar4{ background:linear-gradient(180deg,#5eff7d,#2ed451); } /* Rad - green */

.label{ margin-top:.3rem; font-size:.8rem; color:#ccc; text-align:center; }

.weapon-output{
  background:#1e1e2f;
  border-radius:.5rem;
  padding:.3rem;
  text-align:center;
  margin-top:.5rem;
  line-height:1.3;
  font-size:.95rem;
}
.weapon-output span{ color:#4e8cff; font-weight:700; }
.small { font-size:0.85rem; color:#bbb; }

#ComplicationOutput {
  background:#1e1e2f;
  border-radius:.5rem;
  padding:.6rem;
  text-align:center;
  margin-top:.5rem;
  line-height:1.3;
  font-size:.95rem;
}
	#ammoOutput {
  background:#1e1e2f;
  border-radius:.5rem;
  padding:.6rem;
  text-align:center;
  margin-top:.5rem;
  line-height:1.3;
  font-size:.95rem;
}

#RationWaterOutput {
  background:#1e1e2f;
  border-radius:.5rem;
  padding:.6rem;
  text-align:center;
  margin-top:.5rem;
  line-height:1.3;
  font-size:.95rem;
}
	#medsOnlyOutput {
  background:#1e1e2f;
  border-radius:.5rem;
  padding:.6rem;
  text-align:center;
  margin-top:.5rem;
  line-height:1.3;
  font-size:.95rem;
}
	#chemsOnlyOutput {
  background:#1e1e2f;
  border-radius:.5rem;
  padding:.6rem;
  text-align:center;
  margin-top:.5rem;
  line-height:1.3;
  font-size:.95rem;
}

	#techOutput {
  background:#1e1e2f;
  border-radius:.5rem;
  padding:.6rem;
  text-align:center;
  margin-top:.5rem;
  line-height:1.3;
  font-size:.95rem;
}

.filter-row {
  display: flex;
  justify-content: space-between;
  gap: 8px;
  width: 100%;
}

.filter-box {
  flex: 1;
}

.filter-box label {
  display: block;
  font-weight: bold;
  margin-bottom: 4px;
}

.filter-box select {
  width: 100%;
  padding: 4px;
  font-size: 14px;
  border-radius: 6px;
  border: 1px solid #555;
  background: #222;
  color: #fff;
}
/* Make town output more compact on small screens */
#townOutput {
  font-size: 0.92rem;           /* slightly smaller base text */
  line-height: 1.28;            /* tighter line spacing */
  padding: 0.5rem;
  margin-top: 0.4rem;
}

#townOutput b {
  font-size: 1.05rem;           /* headings still stand out a bit */
}

#townOutput i {
  font-size: 0.86rem;           /* flavor text smaller */
  opacity: 0.9;
  line-height: 1.25;
}

/* Reduce vertical spacing everywhere in town output */
#townOutput > * {
  margin: 0.35rem 0;            /* was probably ~0.8‚Äì1rem */
}

#townOutput div[style*="margin-left"] {
  margin: 0.3rem 0 0.3rem 12px !important;  /* tighter indent & spacing */
  font-size: 0.9rem;
}

/* Make shop items more compact */
#townOutput b + div {
  margin-bottom: 0.4rem !important;
}

/* Optional: even smaller on very narrow screens */
@media (max-width: 420px) {
  #townOutput {
    font-size: 0.88rem;
    line-height: 1.25;
  }
  #townOutput b {
    font-size: 1rem;
  }
}
.section-spacer {
  height: 0rem;       /* ‚Üê adjust this value ‚Äî 0.3 to 0.6rem feels good on mobile */
  width: 100%;
}
</style>
<script type="module" src="constants.js"></script>
</head>
<body>


<div class="container">
<h2>üé≤ Armor Distributor</h2>
  <input type="number" id="inputValue" min="0" value="10" placeholder="Enter integer">

  <!-- Hidden evenness slider (kept so JS can reference it; value remains 0.5 by default) -->
  <input type="range" id="evennessSlider" min="0" max="1" step="0.01" value="0.5" style="display:none;">

  <button onclick="distribute()">Distribute</button>

  <div class="bars">
    <div class="bar-container">
      <div class="bar" id="bar1"><span></span></div>
      <div class="label">Physical</div>
    </div>
    <div class="bar-container">
      <div class="bar" id="bar2"><span></span></div>
      <div class="label">Energy</div>
    </div>
    <div class="bar-container">
      <div class="bar" id="bar3"><span></span></div>
      <div class="label">Explosive</div>
    </div>
    <div class="bar-container">
      <div class="bar" id="bar4"><span></span></div>
      <div class="label">Rad</div>
    </div>
  </div>
</div>
<div class="container">
<h2>üéöÔ∏è Party Level</h2>
<input type="number" id="partyLevel" min="1" value="5" placeholder="Party Level">
<h2>üõ°Ô∏è Armor Generator</h2>
<div id="armorTitle"  style="font-size: 18px; text-align: center; margin-bottom: 10px;">No armor generated yet</div>
<button id="generateArmorBtn" onclick="generateArmor()">Generate Armor</button>



<h2>‚öîÔ∏è Weapon Generator</h2>

  <div class="filter-row">
	  <div class="filter-box">
	  <select id="damageFilter">
		<option value="all">All Damage Types</option>
		<option value="P">Physical (P)</option>
		<option value="E">Energy (E)</option>
		<option value="X">Explosive (X)</option>
		<option value="R">Rad (R)</option>
	  </select>
	  </div>
	   <div class="filter-box">
	  <select id="typeFilter">
		<option value="all">All Weapon Types</option>
		<option value="melee">Melee</option>
		<option value="range">Ranged</option>
	  </select>
	  
		</div>

	</div>
<button onclick="generateWeapon()">Generate Weapon</button>
  <div id="weaponResult" class="weapon-output small"></div>
</div> 

<div class="container">  
  <h2>‚ö†Ô∏è Complications </h2>
  <button onclick="generateComplications()">Generate Complications</button>
  <div id="ComplicationOutput" class="output"></div>
</div>
	
<div class="container">
	<div class="generator-box">
  	<h2>üí• Ammo</h2>
 	 <button onclick="generateAmmo()">Generate Ammo</button>
  	<div id="ammoOutput" class="output"></div>
</div></div>  


	
<div class="container">		
<h2>üçû Scrap/Rations/Water </h2>
<button onclick="generateRations()">Generate Items</button>
<div id="RationWaterOutput" style="margin-top: 10px;"></div>
</div>

<div class="container">
  <h2>üíâ Meds</h2>
  <button onclick="generateMeds()">Generate Meds</button>
  <div id="medsOnlyOutput" class="output"></div>
</div>

<div class="container">
  <h2>‚ò£Ô∏è Chems</h2>
  <button onclick="generateChems()">Generate Chems</button>
  <div id="chemsOnlyOutput" class="output"></div>
</div>


<div class="container">
  <div class="generator-box">
    <h2>üß∞ Technology</h2>
    <button onclick="generateTech()">Generate Technology</button>
    <div id="techOutput" class="output"></div>
  </div>
</div>

<div class="container">
  <div class="generator-box">
    <h2>üèòÔ∏è Town Generator</h2>
    <button onclick="generateTown()">Generate Town</button>
    <div id="townOutput" class="output"></div>
  </div>
</div>



<script>
/* ---------- Integer Distributor ---------- */
function rollDie(sides){ return Math.floor(Math.random()*sides)+1; }

/* Keep same variable name the rest of the code expects */
const slider = document.getElementById('evennessSlider');

function generateDistribution(total) {
  const evenness = parseFloat(slider.value) || 0;
  const base = total / 4;
  let parts = [];

  if (evenness === 0) {
    parts = [base, base, base, base];
  } else {
    let devs = Array.from({ length: 4 }, () => (Math.random() * 2 - 1) * evenness);
    const sumDev = devs.reduce((a, b) => a + b, 0);
    devs = devs.map(d => d - sumDev / 4);

    parts = devs.map(d => base + base * d);

    const factor = total / parts.reduce((a, b) => a + b, 0);
    parts = parts.map(p => Math.round(p * factor));

    let diff = total - parts.reduce((a, b) => a + b, 0);
    for (let i = 0; i < Math.abs(diff); i++) {
      parts[i % 4] += diff > 0 ? 1 : -1;
    }
  }

  return parts;
}
	function distribute() {
  const total = parseInt(document.getElementById('inputValue').value) || 0;
  const parts = generateDistribution(total);

  const maxVal = Math.max(...parts, 1);
  const containerH = 120;

  parts.forEach((p, i) => {
    const bar = document.getElementById('bar' + (i + 1));
    bar.style.height = (p / maxVal * containerH) + 'px';
    bar.querySelector('span').textContent = p;
  });
}
	
	
/* initialize on load */
window.addEventListener('load', distribute);

// ===== ARMOR GENERATOR =====

// helper for single die roll
function rollDie(sides){ return Math.floor(Math.random() * sides) + 1; }

function generateArmor() {
  const level = parseInt(document.getElementById("partyLevel").value) || 0;
  const roll = Math.min(16, rollDie(6) + level);

  const armorEntry = armorTable.find(a => a.roll === roll);
  if (!armorEntry) return;

  let armorText = armorEntry.text;

  // Extract DEF value from text (number after "+X def")
  const defMatch = armorText.match(/\+(\d+)\s*def/i);
  if (!defMatch) {
    console.error("No DEF value found in armor text:", armorText);
    return;
  }

  let defValue = parseInt(defMatch[1], 10);

  // Handle Heavy logic
  let isHeavy = /heavy/i.test(armorText);
  if (!isHeavy && rollDie(6) <= 2) {
    isHeavy = true;
    defValue += 4;	
	armorText = armorText.replace(/\+\d+\s*def/i, `+${defValue} def`);
  }

  // Distribute DEF using existing logic
   const distribution = generateDistribution(defValue);
	if (typeof updateBars === "function") {
    updateBars(values);
  }

  // Output armor text + distribution
  const distText = `(${distribution.join(", ")})`;
	
	// Split armor name from the rest of the text

const nameMatch = armorText.match(/^([^:]+):\s*(.*)$/);

let armorName = armorText;
let armorStats = "";

if (nameMatch) {
  armorName = nameMatch[1];
  armorStats = nameMatch[2];
}
if (isHeavy) {
  armorName = `<span style="color:red; font-weight:bold;">(H)</span> ${armorName}`;
}
	
// Output with name on first line, stats on second
document.getElementById("armorTitle").innerHTML = `
  <b>${armorName}</b><br>
  ${armorStats} ${distText}
`;
}

/* ---------- Weapon data & generator (unchanged logic) ---------- */

/* Weapon generator with filters */
function generateWeapon(){
  const level = parseInt(document.getElementById('partyLevel').value) || 1;
  const dmgFilter = document.getElementById('damageFilter').value;
  const typeFilter = document.getElementById('typeFilter').value;
  const out = document.getElementById('weaponResult');

  let attempt=0, chosen=null, category="", tierRoll=0;
  while(attempt<50){
    attempt++;
    const d1 = rollDie(6), d2 = rollDie(6);
    category = (d1 % 2 === 0 ? 'E' : 'O') + d2;
    tierRoll = rollDie(6) + level;
    const table = weapons[category];
    if(!table) continue;
    const weapon = table.find(e=>tierRoll<=e[0]) || table[table.length-1];

    // determine damage letter: first letter from damage string that matches P, E, X, R
    const dmgMatch = (weapon[2] || "").match(/[PEXR]/);
    const dmgType = dmgMatch ? dmgMatch[0] : "P";

    // weapon type: treat "melee" string as melee, everything else as range
    const wepType = (weapon[4] === "melee") ? "melee" : "range";

    if((dmgFilter==="all" || dmgFilter===dmgType) &&
       (typeFilter==="all" || typeFilter===wepType)){
      chosen = weapon;
      break;
    }
  }
  // üéØ Heavy mechanic (1/3 chance)
let isHeavy = Math.random() < 1 / 3;

// Copy damage text so we can modify it safely
let damageText = chosen[2];

if (isHeavy) {
  // AxB weapons (e.g. 3x6 P, 2x4 E)
  const axbMatch = damageText.match(/^(\d+)x(\d+)\s*(.*)$/i);

  if (axbMatch) {
    const a = axbMatch[1]; // first number stays the same
    const b = parseInt(axbMatch[2], 10) + 1; // ONLY increase second number
    const rest = axbMatch[3] || "";

    damageText = `${a}x${b} ${rest}`.trim();
  } else {
    // Flat damage (e.g. 7 P, 10 X splash)
    const flatMatch = damageText.match(/^(\d+)\s*(.*)$/i);
    if (flatMatch) {
      const base = parseInt(flatMatch[1], 10) + 1;
      const rest = flatMatch[2] || "";

      damageText = `${base} ${rest}`.trim();
    }
  }
}

   
  if(!chosen){
    out.innerHTML = `<span>No weapon matches your filters.</span>`;
    return;
  }

  out.innerHTML = `<span style="font-size:1.25em; font-weight:bold;">${isHeavy ? "<span style='color:red; font-weight:bold;'>(H)</span> " : ""}${chosen[1]}</span><br>
                 Damage: ${damageText}  ‚Ä¢  Ammo: ${chosen[3]}<br>
                 Range: ${chosen[4]}  ‚Ä¢  Stat: ${chosen[5]}  ‚Ä¢  Value: ${chosen[6]}`;
}
// ===== COMPLICATION GENERATOR =====

function generateComplications() {
  const c1 = complications[Math.floor(Math.random() * complications.length)];
  
  document.getElementById("ComplicationOutput").innerHTML =
    ` ${c1[0]} | Save: ${c1[1]}<br><i>${c1[2]}</i>`;
}

// ===== RATION GENERATOR =====
function generateRations() {
  const rolls = rollDie(6) + rollDie(6);

  const counts = {
    "Armor/Clean": 0,
    "Gun/Dirty": 0,
    "Tech/Irradiated": 0
  };

  for (let i = 0; i < rolls; i++) {
    const type = rationTypes[Math.floor(Math.random() * rationTypes.length)];
    counts[type]++;
  }

  let output = `<b>Total Items:</b> ${rolls}<br>`;
  for (const type in counts) {
    if (counts[type] > 0) {
      output += `${type}: ${counts[type]}<br>`;
    }
  }

  document.getElementById("RationWaterOutput").innerHTML = output;
}
function generateMeds() {
  const med = medTable[Math.floor(Math.random() * medTable.length)];
  const count = rollDie(6) + 1;

  document.getElementById("medsOnlyOutput").innerHTML = `
    <b>${med.name} x${count}</b><br>
    <i>${med.effect}</i>
  `;
}
function generateChems() {
  const chem = chemTable[Math.floor(Math.random() * chemTable.length)];
  const count = rollDie(6) + 1;

  document.getElementById("chemsOnlyOutput").innerHTML = `
    <b>${chem.name} x${count}</b><br>
    <i>${chem.effect}</i>
  `;
}




function rollGrenadeByLevel(level) {
  const roll = rollDie(6) + level;
  return grenadeTable.find(g => roll <= g.max);
}

// Simple dice roller helper
function rollDice(diceStr) {
  const match = diceStr.match(/(\d*)d(\d+)([+-]\d+)?/i);
  if (!match) return 0;

  const count = parseInt(match[1], 10) || 1;
  const sides = parseInt(match[2], 10);
  const modifier = parseInt(match[3], 10) || 0;

  let total = 0;
  for (let i = 0; i < count; i++) {
    total += Math.floor(Math.random() * sides) + 1;
  }

  const result = total + modifier;

  // üîí HARD CLAMP TO VALID RANGE
  const min = count + modifier;
  const max = count * sides + modifier;

  return Math.max(min, Math.min(result, max));
}


function generateAmmo() {
  const selected = ammoTable[Math.floor(Math.random() * ammoTable.length)];
  const quantity = rollDice(selected.roll);
  const level = parseInt(document.getElementById("partyLevel").value) || 0;

  // Special grenade handling
  if (selected.type === "Grenades") {
    const grenade = rollGrenadeByLevel(level);
    document.getElementById("ammoOutput").innerHTML =
      `${quantity} x ${grenade.name}<br>` +
      `${grenade.dmg}, thrown, STR, ${grenade.cost}`;
    return;
  }
  // Normal ammo output
  const costText = selected.cost > 0 ? `${selected.cost}c each` : "";
  document.getElementById("ammoOutput").innerHTML =
    `${quantity} x ${selected.type} ${costText}`;
}

// ===== TECHNOLOGY GENERATOR =====


function generateTech() {
  const tech = techTable[Math.floor(Math.random() * techTable.length)];

  document.getElementById("techOutput").innerHTML = `
    <b>${tech.name}</b><br>
    <i>${tech.effect}</i>
  `;
}

// ===== TOWN GENERATOR =====






function getRivalFaction(mainFactionName) {
  const rivals = factions.filter(f => f.name !== mainFactionName);
  return rivals[Math.floor(Math.random() * rivals.length)];
}





function generateTown() {
  let output = "";

  // ===== TOWN TYPE =====
  const d1 = rollDie(6);
  const d2 = rollDie(6);
  const roll = d1 * 10 + d2;

  const descriptor = townDescriptors.find(t => t.roll === roll);

  output += `<b>Town Type:</b> ${descriptor?.name || "Unknown Settlement"}<br>`;
  output += `<i>${descriptor?.desc || ""}</i><div class="section-spacer"></div>`;
  
    // ===== FACTION =====
	const faction = factions[Math.floor(Math.random() * factions.length)];

	output += `<b>Faction:</b> ${faction.name} <br>`;
	output += `<i>${faction.desc}</i><div class="section-spacer"></div>`;
	
	
	// ===== NOTABLE NPCs (3 total) =====
	output += `<b>Notable NPCs:</b><br>`;

	for (let i = 0; i < 3; i++) {
	  const n1 = rollDie(6);
	  const n2 = rollDie(6);
	  const nRoll = n1 * 10 + n2;

	  const npc = npcTable.find(n => n.roll === nRoll);

	  output += `<div style="margin-left:10px; margin-bottom:6px;">
				   <b>${npc?.name || "Unknown NPC"}:</b>
				   <i>${npc?.desc || ""}</i>
				 <div class="section-spacer"></div></div>`;
	}

	



	// ===== MAIN QUEST =====
	const q1 = rollDie(6);
	const q2 = rollDie(6);
	const qRoll = q1 * 10 + q2;

	let quest = townQuests.find(q => q.roll === qRoll)?.text || "Unknown Quest";

	// If the quest references "X faction", insert a rival faction
	if (quest.includes("X faction") || quest.includes("X enemy")) {
	  const rival = getRivalFaction(faction.name);
	  quest = quest.replace(/X faction|X enemy/g, rival.name);
	}

	output += `<b>Main Quest:</b> ${quest}<div class="section-spacer"></div>`;


  // ===== SIDEQUEST (Profession Quest) =====
  const professions = Object.keys(professionQuests);
  const chosenProf = professions[Math.floor(Math.random() * professions.length)];
  const sidequest = professionQuests[chosenProf][Math.floor(Math.random() * 3)];

  output += `<b>Sidequest (${chosenProf}):</b> ${sidequest}<div class="section-spacer"></div>`;


  // ===== SHOPS =====
output += "";

// 1. Find the faction's signature shop
const signatureShop = shopTypes.find(shop => shop.name.toLowerCase().includes(faction.tag.toLowerCase())) 
                     || shopTypes.find(shop => shop.name === "Weapons"); // fallback

// 2. We'll display 3 shops total
const shopSlots = [1, 2, 3];

// We want the signature shop to appear exactly once ‚Üí we'll place it randomly among the 3 slots
const signatureSlotIndex = Math.floor(Math.random() * 3); // 0, 1 or 2

for (let i = 0; i < shopSlots.length; i++) {
  let chosenShop;

  if (i === signatureSlotIndex) {
    // This is the guaranteed faction shop
    chosenShop = signatureShop;
  } else {
    // Random shop, but try to avoid duplicating the signature one too often
    let attempts = 0;
    do {
      chosenShop = shopTypes[Math.floor(Math.random() * shopTypes.length)];
      attempts++;
    } while (chosenShop.name === signatureShop.name && attempts < 10);
  }

  output += `<b>Shop ${i+1}: ${chosenShop.name}</b> `;
  
  // Mark the faction specialty shop
  if (chosenShop.name === signatureShop.name) {
    output += `<span style="color:#4e8cff; font-weight:bold;">(Faction)</span><div class="section-spacer"></div>`;
  }
 

  // Generate 2 items for this shop
  for (let r = 0; r < 2; r++) {
    let result = "";
    switch (chosenShop.name) {
      case "Weapons":
        generateWeapon();
        result = document.getElementById("weaponResult").innerHTML;
        break;
      case "Armor":
        generateArmor();
        result = document.getElementById("armorTitle").innerHTML;
        break;
      case "Meds":
        generateMeds();
        result = document.getElementById("medsOnlyOutput").innerHTML;
        break;
      case "Chems":
        generateChems();
        result = document.getElementById("chemsOnlyOutput").innerHTML;
        break;
      case "Tech":
        generateTech();
        result = document.getElementById("techOutput").innerHTML;
        break;
      case "Food & Water":
        generateRations();
        result = document.getElementById("RationWaterOutput").innerHTML;
        break;
      default:
        result = "<i>(no items generated)</i>";
    }

    output += `<div style="margin-left:14px; margin-bottom:8px;">${result}</div><div class="section-spacer"></div>`;
  }


}

  document.getElementById("townOutput").innerHTML = output;
}



	
</script>
</body>
</html>



